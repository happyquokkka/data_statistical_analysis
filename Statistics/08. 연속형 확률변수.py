#!/usr/bin/env python
# coding: utf-8

# # ì—°ì†í˜• í™•ë¥ ë³€ìˆ˜

# ## ì—°ì†í˜• í™•ë¥ ë³€ìˆ˜
# 
# - í™•ë¥ ë³€ìˆ˜ê°€ ì·¨í•  ìˆ˜ ìˆëŠ” ê°’ì´ ì—°ì†ì ì¸ í™•ë¥ ë³€ìˆ˜
# - íŠ¹ì • ê°’ì„ ì·¨í•˜ëŠ” í™•ë¥ ì€ ì •ì˜ë˜ì§€ ì•ŠìŒ
# - í™•ë¥ ë³€ìˆ˜ê°€ ì–´ëŠ êµ¬ê°„ì— ë“¤ì–´ê°€ëŠ”ê°€ì— ëŒ€í•œ í™•ë¥ ì„ ì •ì˜
# 
# 
# - [ì˜ˆ] ë£°ë › :
#     - ì·¨í•  ìˆ˜ ìˆëŠ” ê°’ì´ 0ë¶€í„° 1 ì‚¬ì´ì˜ ì‹¤ìˆ˜
#     - í° ìˆ˜ì¼ìˆ˜ë¡ ë‚˜ì˜¤ê¸° ì‰¬ì›Œì§€ëŠ” ë¶ˆê³µì •í•œ êµ¬ì¡°
#     - 0.5 ë¼ëŠ” ê°’ì„ ì·¨í•  í™•ë¥  = 0
#         - ì •í™•í•˜ê²Œ 0.5000000000000... ë¥¼ ì·¨í•  ê°€ëŠ¥ì„±ì´ ì—†ìœ¼ë¯€ë¡œ í™•ë¥ ì€ 0

# ### í™•ë¥  ë°€ë„ í•¨ìˆ˜
# 
# - í™•ë¥ ë³€ìˆ˜ê°€ ì·¨í•  ìˆ˜ ìˆëŠ” ê°’ì€ êµ¬ê°„[a, b]ìœ¼ë¡œ ê²°ì •ë¨
# - í™•ë¥  ë°€ë„ í•¨ìˆ˜(PDF) ë˜ëŠ” ë°€ë„í•¨ìˆ˜ f(x)ë¡œ ì •ì˜
# 
# 
# - ì–´ë–¤ íŠ¹ì • ê°’ì„ ì·¨í•˜ëŠ” í™•ë¥ ë¡œëŠ” ì •ì˜ë˜ì§€ ì•ŠìŒ
#     - ğ‘“(ğ‘¥) â‰ ğ‘ƒ(ğ‘‹=ğ‘¥)
# 
# ![](./ë°€ë„ì ë¶„.png)
# 
# 
# - ì´ ì ë¶„ì€ ë°€ë„í•¨ìˆ˜ f(x)ì™€ xì¶•, ê·¸ë¦¬ê³  ë‘ ì§ì„  x=x0, x=x1ìœ¼ë¡œ ë‘˜ëŸ¬ì‹¸ì¸ ì˜ì—­ì˜ ë©´ì ìœ¼ë¡œ í•´ì„í•  ìˆ˜ ìˆìŒ
#     - ê·¸ë¦¼ì—ì„œ ì¹ í•´ì§„ ë©´ì ì´ í™•ë¥  P

# #### ë¶ˆê³µì •í•œ ë£°ë ›ì„ ì˜ˆë¡œ ë“¤ì–´ ì½”ë“œë¥¼ êµ¬í˜„
# - ì·¨í•  ìˆ˜ ìˆëŠ” ê°’ì´ 0ë¶€í„° 1 ì‚¬ì´ì˜ ì‹¤ìˆ˜
# - í° ìˆ˜ì¼ìˆ˜ë¡ ë‚˜ì˜¤ê¸° ì‰¬ì›Œì§€ëŠ” ë¶ˆê³µì •í•œ êµ¬ì¡°

# In[2]:


import numpy as np
import matplotlib.pyplot as plt

get_ipython().run_line_magic('precision', '3')
get_ipython().run_line_magic('matplotlib', 'inline')


# In[1]:


from scipy import integrate
import warnings

# ì ë¶„ì— ê´€í•œ warningì„ ì¶œë ¥í•˜ì§€ ì•Šë„ë¡ í•œë‹¤
warnings.filterwarnings('ignore',
                        category=integrate.IntegrationWarning)


# In[3]:


from IPython.core.interactiveshell import InteractiveShell
InteractiveShell.ast_node_interactivity="all"


# In[4]:


# ì·¨í•  ìˆ˜ ìˆëŠ” ê°’ì˜ êµ¬ê°„ì„ ì •ì˜
x_range = np.array([0,1])


# - x_rangeë¥¼ ì •ì˜ì—­ìœ¼ë¡œ í•˜ëŠ” ë°€ë„ í•¨ìˆ˜ë¥¼ êµ¬í˜„
#     - ë¶ˆê³µì •í•œ ë£°ë ›ì€ í° ê°’ì¼ìˆ˜ë¡ ë‚˜ì˜¤ê¸° ì‰¬ì›€ â†’ ì•„ë˜ì™€ ê°™ì€ ë°€ë„í•¨ìˆ˜ë¡œ ì •ì˜
# ![](./ë£°ë ›ë°€ë„í•¨ìˆ˜.png)

# In[5]:


def f(x) :
    if x_range[0] <= x <= x_range[1] :
        return 2 * x
    else :
        return 0


# In[6]:


f(0.4)
# ì´ ì‹ì€ 0.4ê°€ ë‚˜ì˜¬ í™•ë¥ ì´ ì•„ë‹˜
# ì—°ì†í˜•ì´ë¯€ë¡œ ë‘ êµ¬ê°„ ê²½ê³„ ìœ„ì¹˜ê°’ì„ í•¨ìˆ˜ë¥¼ í†µí•´ êµ¬í•´ì„œ ë©´ì ì„ ê·¸ë¦° í›„ í•´ë‹¹ ë©´ì ì„ ì ë¶„í•˜ì—¬ êµ¬í•¨
# ë°˜í™˜ë˜ëŠ” ë©´ì ì˜ ê°’ì´ ë‘ êµ¬ê°„ ë²”ìœ„ì˜ í™•ë¥ ì„


# In[7]:


# í™•ë¥ ë³€ìˆ˜ Xë¥¼ ì •ì˜
x = [x_range, f]


# - ìœ„ì—ì„œ ì‘ì„±í•œ ë°€ë„í•¨ìˆ˜ f(x)ë¥¼ ê·¸ë˜í”„ë¡œ ê·¸ë¦¼
#     - í™•ë¥ ì˜ ì´ë¯¸ì§€ë¥¼ ì‰½ê²Œ ì „ë‹¬í•˜ê¸° ìœ„í•´ f(x)ì™€ xì¶•, ë‘ ì§ì„  x=0.4, x=0.6ì˜ ì˜ì—­ì— ìƒ‰ì„ ì ìš©
#     - ë¶ˆê³µì •í•œ ë£°ë ›ì´ 0.4ë¶€í„° 0.6 ì‚¬ì´ì˜ ê°’ì„ ì·¨í•  í™•ë¥ 

# In[10]:


xs = np.linspace(x_range[0], x_range[1], 100) # x=0, x=1 ì‚¬ì´ì—ì„œ ë°œìƒí•  ìˆ˜ ìˆëŠ” 100ê°œì˜ ê°’ì„ ì¶”ì¶œ = xì¶•ì˜ ê°’ 

fig = plt.figure(figsize=(10, 6))
ax = fig.add_subplot(111)

# í™•ë¥ í•¨ìˆ˜ ê·¸ë˜í”„
ax.plot(xs, [f(x) for x in xs], label='f(x)', color='gray')
# y ê°’ = [f(x) for x in xs]

#ax.hlines(y, xmin, xmax, alpha=)
ax.hlines(0, -0.2, 1.2, alpha=0.3)

#ax.vlines(x, ymin, ymax, alpha=)
ax.vlines(0, -0.2, 2.2, alpha=0.3)
ax.vlines(xs.max(), 0, 2.2, linestyles=':', color='gray')

# 0.4 ë¶€í„° 0.6 ê¹Œì§€ x ì¢Œí‘œë¥¼ ì¤€ë¹„
xs_p = np.linspace(0.4, 0.6, 100)

# xs_pì˜ ë²”ìœ„ë¡œ f(x)ì™€ xì¶•ìœ¼ë¡œ ë‘˜ëŸ¬ì‹¸ì¸ ì˜ì—­ì„ ì§„í•˜ê²Œ ì¹ í•¨
ax.fill_between(xs_p, [f(x) for x in xs_p], label='prob')

ax.set_xticks(np.arange(-0.2, 1.3, 0.1))
ax.set_xlim(-0.1, 1.1)
ax.set_ylim(-0.2, 2.1)
ax.legend()

plt.show()


# ### plt.plt.fill_between() ì˜ˆì‹œ

# In[11]:


import matplotlib.pyplot as plt

x = [1, 2, 3, 4]
y = [1, 4, 9, 16]

plt.plot(x, y) # ì› ì†ŒìŠ¤ì˜ ê·¸ë˜í”„ë¥¼ ê·¸ë¦¬ê³ , ê·¸ ì¤‘ì— ì•Œê³  ì‹¶ì€ í™•ë¥ ë§Œ ë©´ì ì„ ìƒ‰ì¹ í•´ì„œ í‘œì‹œ
plt.xlabel('X-Label')
plt.ylabel('Y-Label')
plt.fill_between(x[1:3], y[1:3], alpha=0.5) ## fill_between() ì‚¬ìš©
x[1:3], y[1:3]
# ë„¤ ì  (x[1], y[1]), (x[2], y[2]), (x[1], 0), (x[2], 0)ì„ ì‡ëŠ” ì˜ì—­ì´ ì±„ì›Œì§

plt.show()


# ### ì—°ì†í˜• í™•ë¥ ë³€ìˆ˜ì˜ í™•ë¥ ì˜ ì„±ì§ˆ
# 
# ![](./í™•ë¥ ì„±ì§ˆ.png)

# - ì²« ë²ˆì§¸ ì„±ì§ˆ : í•¨ìˆ˜ f(x)ëŠ” 0ë³´ë‹¤ ê°™ê±°ë‚˜ ì»¤ì•¼ í•¨
#     - ìœ„ ì„±ì§ˆì„ í™•ì¸í•˜ê¸° ìœ„í•´ì„œëŠ” minimize_scalar í•¨ìˆ˜ ì‚¬ìš©
#     - minimize_scalar() : í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•œ ê²°ê³¼ê°’ì´ ìµœì†Œê°€ ë˜ëŠ” xê°’ê³¼ ìµœì†Œ ê²°ê³¼ yë¥¼ ë°˜í™˜

# In[14]:


from scipy.optimize import minimize_scalar

def func(x) :
    return (x-1.5)**2 + 0.5

res = minimize_scalar(func)
res.x # ìµœì†Œê°’ì„ ë§Œë“¤ì–´ ë‚¸ xê°’
res.fun # í•¨ìˆ˜ê°€ ë§Œë“¤ì–´ë‚¼ ìˆ˜ ìˆëŠ” ìµœì†Œê°’


# In[15]:


# ìœ„ì—ì„œ ìƒì„±í•´ ë†“ì€ ë¶ˆê³µì • ë£°ë ›ì˜ í™•ë¥ í•¨ìˆ˜
def f(x):
    if x_range[0] <= x <= x_range[1]:
        return 2 * x
    else:
        return 0


# In[18]:


from scipy.optimize import minimize_scalar

res = minimize_scalar(f)
res.x
res.fun # 0ì´ ë°˜í™˜ëìœ¼ë¯€ë¡œ ì²« ë²ˆì§¸ í™•ë¥ ì˜ ì„±ì§ˆì„ ë§Œì¡±


# - ìœ„ ì—°ì‚°ì˜ í™•ì¸ìœ¼ë¡œ ì¸í•´ f(x) >= 0 ì´ë¼ëŠ” ì—°ì†í˜• í™•ë¥ ë³€ìˆ˜ì˜ ì„±ì§ˆì´ ë§Œì¡±í•¨ì„ ì•Œ ìˆ˜ ìˆìŒ

# #### ì—°ì†í˜• í™•ë¥ ë³€ìˆ˜ì˜ ë‘ ë²ˆì§¸ í™•ë¥ ì˜ ì„±ì§ˆ
# 
# ![](./í™•ë¥ ì„±ì§ˆ2.png)

# - ë‘ë²ˆì§¸ f(x)ë¥¼ ï¼âˆ ë¶€í„° âˆ ê¹Œì§€ ì ë¶„í•œ ê²°ê³¼ê°€ 1ì´ë¼ëŠ” ê²ƒì€ ìœ„ ê·¸ë¦¼ì—ì„œ ì‚¼ê°í˜•ì˜ ë©´ì ì´ 1ì´ ë˜ëŠ” ê²ƒê³¼ ê°™ë‹¤
#     - ì´ ì‚¼ê°í˜•ì€ ë°‘ë³€ì˜ ê¸¸ì´ê°€ 1, ë†’ì´ê°€ 2 ì´ë¯€ë¡œ ë©´ì ì´ 1ì´ë¼ëŠ” ê²ƒì„ ê°„ë‹¨íˆ ì•Œ ìˆ˜ ìˆìŒ

# ### í™•ë¥ ì˜ ë‘ ë²ˆì§¸ ì„±ì§ˆì„ ìˆ˜ì¹˜ì ë¶„ í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•´ ë§Œì¡±í•˜ëŠ”ì§€ í™•ì¸
# 
# #### quad() : ìˆ˜ì¹˜ì ë¶„ í•¨ìˆ˜
# 
# - **ìˆ˜ì¹˜ì ë¶„(numerical integration)**ì€ í•¨ìˆ˜ë¥¼ ì•„ì£¼ ì‘ì€ êµ¬ê°„ìœ¼ë¡œ ë‚˜ëˆ„ì–´ ì‹¤ì œ ë©´ì ì„ ê³„ì‚°í•¨ìœ¼ë¡œì¨ ì •ì ë¶„ì˜ ê°’ì„ êµ¬í•˜ëŠ” ë°©ë²•ì´ë‹¤. 
# - Scipyì˜ integrate ì„œë¸ŒíŒ¨í‚¤ì§€ì˜ quad ëª…ë ¹ìœ¼ë¡œ ìˆ˜ì¹˜ì ë¶„ì„ í•  ìˆ˜ ìˆë‹¤.
# 
# - ì²« ë²ˆì§¸ ì¸ìˆ˜ëŠ” í”¼ì ë¶„í•¨ìˆ˜ã€ë‘ ë²ˆì§¸ ì¸ìˆ˜ì™€ ì„¸ ë²ˆì§¸ ì¸ìˆ˜ëŠ” ì ë¶„ ë²”ìœ„
#     - __ì²« ë²ˆì§¸ ë°˜í™˜ê°’ì´ ìˆ˜ì¹˜ ì ë¶„ìœ¼ë¡œ ì–»ì–´ì§„ ê²°ê³¼(ë©´ì )ì´ë©°, ë‘ ë²ˆì§¸ì˜ ê°’ì€ ì¶”ì • ì˜¤ì°¨__
# 

# In[19]:


# ë‘ ë²ˆì§¸ ì„±ì§ˆì„ ì ë¶„ ê³„ì‚°ìœ¼ë¡œ í™•ì¸
# -ë¬´í•œëŒ€ì™€ +ë¬´í•œëŒ€ëŠ” np.infë¡œ í‘œí˜„í•  ìˆ˜ ìˆìŒ -> np.inf : ë¬´í•œëŒ€ | -np.inf : ë§ˆì´ë„ˆìŠ¤ë¬´í•œëŒ€
integrate.quad(f, -np.inf, np.inf)

# f(x)ë¥¼ -ë¬´í•œëŒ€ë¶€í„° +ë¬´í•œëŒ€ê¹Œì§€ ì ë¶„í•œ ê²°ê³¼ê°€ 1ì´ì–´ì•¼ í•¨ - ë‘ë²ˆì§¸ í™•ë¥ ì˜ ì„±ì§ˆ


# In[21]:


xs = np.linspace(x_range[0], x_range[1], 100) # x=0, x=1 ì‚¬ì´ì—ì„œ ë°œìƒí•  ìˆ˜ ìˆëŠ” 100ê°œì˜ ê°’ì„ ì¶”ì¶œ = xì¶•ì˜ ê°’ 

fig = plt.figure(figsize=(10, 6))
ax = fig.add_subplot(111)

# í™•ë¥ í•¨ìˆ˜ ê·¸ë˜í”„
ax.plot(xs, [f(x) for x in xs], label='f(x)', color='gray')
# y ê°’ = [f(x) for x in xs]

#ax.hlines(y, xmin, xmax, alpha=)
ax.hlines(0, -0.2, 1.2, alpha=0.3)

#ax.vlines(x, ymin, ymax, alpha=)
ax.vlines(0, -0.2, 2.2, alpha=0.3)
ax.vlines(xs.max(), 0, 2.2, linestyles=':', color='gray')

# 0.4 ë¶€í„° 0.6 ê¹Œì§€ x ì¢Œí‘œë¥¼ ì¤€ë¹„
xs_p = np.linspace(0.4, 0.6, 100)

# xs_pì˜ ë²”ìœ„ë¡œ f(x)ì™€ xì¶•ìœ¼ë¡œ ë‘˜ëŸ¬ì‹¸ì¸ ì˜ì—­ì„ ì§„í•˜ê²Œ ì¹ í•¨
ax.fill_between(xs_p, [f(x) for x in xs_p], label='prob')

ax.set_xticks(np.arange(-0.2, 1.3, 0.1))
ax.set_xlim(-0.1, 1.1)
ax.set_ylim(-0.2, 2.1)
ax.legend()

plt.show()


# - ìœ„ ì‚¬ë‹¤ë¦¬ê¼´ ì˜ì—­ì„ ì ë¶„ìœ¼ë¡œ êµ¬í•˜ëŠ” ì‹
# ![](./ì ë¶„ì‹.png)

# In[24]:


# 2xëŠ” í•¨ìˆ˜ f(x)ê°€ êµ¬í˜„í•˜ê³  ìˆìŒ
integrate.quad(f, 0.4, 0.6)

# ì ë¶„ê°’ì´ 0.200 ì´ë¯€ë¡œ 0.4ì—ì„œ 0.6ì´ ë‚˜ì˜¬ í™•ë¥ ì€ 0.2


# ### ëˆ„ì  ë¶„í¬ í•¨ìˆ˜
# 
# - í™•ë¥ ë³€ìˆ˜ Xê°€ x ì´í•˜ê°€ ë  ë•Œì˜ í™•ë¥ ì„ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜
# ![](./ëˆ„ì ë¶„.png)

# In[25]:


# ë¶„í¬í•¨ìˆ˜ êµ¬í˜„

def F(x) :
    return integrate.quad(f, -np.inf, x)[0] # [0]ì´ ì ë¶„ê°’ì— í•´ë‹¹í•˜ê³ , [1]ì€ ì¶”ì • ì˜¤ì°¨ê°’ì— í•´ë‹¹í•¨


# - ë£°ë › 0.4ì—ì„œ 0.6 ì‚¬ì´ì˜ ê°’ì„ ì·¨í•  í™•ë¥ 
# ![](./ëˆ„ì ë¶„2.png)

# In[26]:


F(0.6) - F(0.4)


# In[27]:


# ë‹¨ì¡°ì¦ê°€í•¨ìˆ˜ í™•ì¸

xs = np.linspace(x_range[0], x_range[1], 100)

fig = plt.figure(figsize=(10, 6))
ax = fig.add_subplot(111)

ax.plot(xs, [F(x) for x in xs], label='F(x)', color='gray')
ax.hlines(0, -0.1, 1.1, alpha=0.3)
ax.vlines(0, -0.1, 1.1, alpha=0.3)
ax.vlines(xs.max(), 0, 1, linestyles=':', color='gray')

ax.set_xticks(np.arange(-0.1, 1.2, 0.1))
ax.set_xlim(-0.1, 1.1)
ax.set_ylim(-0.1, 1.1)
ax.legend()

plt.show()


# ### ì—°ì†í˜• í™•ë¥  ë¶„í¬ì˜ ì§€í‘œ
# 
# #### í‰ê·  - ê¸°ëŒ€ê°’
# ![](./ì—°ì†ê¸°ëŒ€.png)

# In[28]:


# ìœ„ì—ì„œ ìƒì„±í•´ ë†“ì€ ë¶ˆê³µì • ë£°ë ›ì˜ í™•ë¥ í•¨ìˆ˜
def f(x):
    if x_range[0] <= x <= x_range[1]:
        return 2 * x
    else:
        return 0


# In[29]:


def integrand(x) : # (x*f(x)) ê³„ì‚° ê²°ê³¼ë¥¼ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜ = í”¼ì ë¶„í•¨ìˆ˜ì— í•´ë‹¹
    return x * f(x)

integrate.quad(integrand, -np.inf, np.inf)[0]


# In[30]:


# í™•ë¥ ë³€ìˆ˜ Xë¥¼ ì •ì˜
X = [x_range, f]


# In[33]:


def E(X, g=lambda x: x) :
    x_range, f = X
    def integrand(x) : # (x(f(x))) ê³„ì‚° ê²°ê³¼ë¥¼ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜
        return g(x) * f(x)
    return integrate.quad(integrand, -np.inf, np.inf)[0]

# subí•¨ìˆ˜ëŠ” E() í•¨ìˆ˜ê°€ í˜¸ì¶œí•˜ëŠ” ìˆœê°„ ìƒì„±ë¨    


# In[34]:


E(X)


# In[35]:


E(X, g=lambda x : 2*x+3)


# In[36]:


2 * E(X) + 3


# ### ë¶„ì‚°
# 
# - Î¼ ëŠ” í™•ë¥ ë³€ìˆ˜ Xì˜ ê¸°ëŒ€ê°’
# 
# ![](./ë¶„ì‚°.png)

# In[38]:


# ë¶„ì‚° ê³„ì‚°
mean = E(X) # í™•ë¥ ë³€ìˆ˜ Xì— ëŒ€í•œ ê¸°ëŒ€ê°’

def integrand(x) :
    return (x-mean)**2 * f(x)

integrate.quad(integrand, -np.inf, np.inf)[0]


# ![](./ë¶„ì‚°ì‹.png)

# - ìœ„ ìˆ˜ì‹ì„ í•¨ìˆ˜ë¡œ êµ¬í˜„

# In[41]:


def V(X, g = lambda x : x) :
    x_range, f = X
    mean = E(X,g) # ê¸°ëŒ€ê°’ ê³„ì‚°
    
    def integrand(x) :
        return (g(x)-mean) **2 * f(x)
    
    return integrate.quad(integrand, -np.inf, np.inf)[0]


# In[42]:


V(X)


# In[43]:


# í™•ë¥ ë³€í™˜ë³€ìˆ˜ì˜ ë¶„ì‚°
V(X, lambda x: 2*x+3)


# In[44]:


# ì´ì‚°í˜• í™•ë¥  ë³€ìˆ˜ì—ì„œ í™•ì¸í–ˆë˜ ë¶„ì‚°ì˜ ì„±ì§ˆì€ ì—°ì†í˜• í™•ë¥ ë³€ìˆ˜ì—ë„ ì ìš©
# ì„±ì§ˆì— ë”°ë¼ ì•„ë˜ ìˆ˜ì‹ìœ¼ë¡œë„ ê³„ì‚° ê°€ëŠ¥
2**2*V(X)

